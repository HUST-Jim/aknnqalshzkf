INSERT INTO datarephash_1
SELECT (n-1)/3+1 AS id, min(x.hash) AS rephash, array_agg(x.id) AS idarray 
    FROM (SELECT id, hash, row_number() OVER (order by hash) AS n FROM datahash_1) x(id, hash, n) GROUP BY (n-1)/3 
ORDER BY id;